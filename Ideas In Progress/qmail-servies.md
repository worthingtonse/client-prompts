# QMail Services
This coveres the actual servics used by Qmail starting with Phase I

## Note about Compact Binary Document Format
Many of the QMail services use the the CBDF to reduce the size of the request to its minium. Here are the 
specifications of the CBDF: 

** Directory CBDF File Format **
| Field                     | Size (Bytes) | Description                                                                 |
|---------------------------|--------------|-----------------------------------------------------------------------------|
| Fixed Fields     | Depends on CBDF File   | This is a header that contains all the fields that are not optional and have a fixed length  |
| Number of Key-Value Pairs | 1            | Unsigned integer (0–255) indicating the number of key-value pairs that follow. |
| Key-Value Pair(s)         | Variable     | Repeated for each pair (as specified by Number of Key-Value Pairs):         |
| &nbsp;&nbsp;Key           | 1            | Unsigned integer (0–255) representing a predefined key (e.g., 0 = "name").  |
| &nbsp;&nbsp;Value Length  | 1            | Unsigned integer (0–255) specifying the length of the value in bytes.       |
| &nbsp;&nbsp;Value         | 0–255        | Binary data for the value (length as specified by Value Length).            |



## Update Director
This uploads information into the director. Every Raida has a compy of the directory so this is uploaded 25 different times. 
It isa whole file designed so everyone can see it. However, it does allow for some permissions. 

* Permissions. White list can see everything. Blacklist can see nothing, light gray list can see
* somethings, dark gray list can
* see less. 

The direcotry can be complicated so we use the Compact Binary Document Format. 

```C
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH
Update Directory CBDF
E3 E3 //end of body
```

### Resource Key Table Version 0
This is for phase I. There is a much larger list available for phase II. 

Directory Update CBDF Fixed Fields:
Name | Bytes | Description
---|---|---
Update Directory Resource Table Version | 0 | Allows for many different listed key tables (Default is zero) 

Note: All data is in binary. Strings are UTC-8 Encoded.

** Update Request Resource Table Version 0 **
ID | Field Name | Example | Description
---|---|---|---
1 |Update Payment Coin Code | 1 | What coin is being used for payment (00 is CloudCoin)
2 | Update Payment Locker Code | ca8d0787f2a84b4babf1ef9f3d118b16 | Locker code for the payment type
3 |"Display Name/Alias" | Varies |"TechWizard" in binary | Primary display name or chosen alias for the user
4 |"Self Description" | Varies |"I'm a nice guy" | Public info about self
5 |"Memo to self" | Varies | This is not read by other people but allows the user to remember why they made updates to the Directory
6 | Allow User List | 00 A3 67 98 E6 72 | Don't need to pay. An array of coin type (Cloudcoin is zero), Denomination, Serial Number 
7 | Deny User List | 00 A3 67 98 E6 72 | Cannot Send. An array of coin type (Cloudcoin is zero), Denomination, Serial Number 
8 | Locker Code Payment for Receiving | 00 08 | 2 bytes. Coin type and Denomination
9 | Thumbnail Stripe| 00 00 18 77 Data  | Data Type (0 for thumbnaile) RAID type, Stripe number, Total Stripes, Data rounded to 100. Up to 250x100=25K bytes
10 |"Email Server 0" |00 8E 82 89 mail.server.com | First Byte: Coin type, Three Bytes: Port Number, Variable Bytes: Server Name or IP max 250 bytes.
45 |"Email Server 35" |00 8E 82 89 mail2.server.com | First Byte: Coin type, Three Bytes: Port Number, Variable Bytes: Server Name or IP max 250 bytes
46 | public key| 00 00 18 77 Data  | Data Type (0 for thumbnaile) RAID type, Stripe number, Total Stripes, Data rounded to 100. Up to 250x100=25K bytes
47 | Verification Servers  |00 8E 82 89 mail.server.com | First Byte: Coin type, Three Bytes: Port Number, Variable Bytes: FQDN. Ampersam seperates servers bytes. 

Return Status Codes

All Good

All Fail

Error Code

Payment Bad

## Search Directory
This allows the user to search for a person in the directory. It will only warn people if they are blacklisted. 

```C
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH 
Directory Search CBDF
E3 E3
```
Directory Search CBDF
Fixed Key | Bytes | Description
---|---|---
0| ob | yt

ID | Field Name | Example | Description
---|---|---|---
1 | Return Columns | 05 DE 23 | One byte per Directory Key 
2 | Limit | 0xA5 | 256 max
3 | Page | 3 bytes | 256 per page. Default is 0
4 | Where Clause | 3 bytes | Directory Key, Comparison Operator, Term


## Send Mail One to One
This service sends an email from one person to another. 

Phase one just sends text based emails. 

```c
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH
Send Email CBDF
E3 E3 
```

Name | Bytes | Description
---|---|---
Email GUID | 16 | A unique number randomly generated by the client and used for all email slices of this email. 
Receiver ID | 5 | 1 byte for coin ID, 1 Denomination, 4 Serial Number
RAID Type | 1 | 0 = Stripe, 1 = Mirror, 5 = Stripe with Parity, 6 = Stripe with Vertical Parity, Stripe with Horizontal Parity, 7 = Striped with Horizontal and Vertical Parity, 8 = Striped with Horizontal, Vertical and Diagnal Parity, 10 = Mirroed stripes
Stripe Number | 1 | A number 0 to N (up to 32 servers)
Of Number |1 | Such as "7" of "25" Where 25 is the Of Number


Send Mail Resource Table
ID | Field Name | Example | Description
---|---|---|---
1 | Shuffle Table Shard 1 | A square of the Of Number. If there are 16 servers, the shuffle table will be 16 x 16 or 256 bytes. This is the first 8 rows.  The numbers in each cell will be represented by five bits. See table below.
2 | Shuffle Table Shard 2 | Like above. This is the Second 8 rows. 
1 | Subject Stipe | 05 DE 23 | Raid type, Stripe Number, OF Number all remaining bytes (253) can be used for the subject. 


Shuffle bytes needed: 

16 x 16  = One Shad __ bytes. 


9 | Thumbnail Stripe| 00 00 18 77 Data  | Data Type (0 for thumbnaile) RAID type, Stripe number, Total Stripes, Data rounded to 100. Up to 250x100=25K bytes




