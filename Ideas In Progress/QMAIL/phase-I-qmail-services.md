# QMail Services
This coveres the actual servics used by Qmail starting with Phase I

## Send Mail/Attachment CBDF
Command Group: 6

Command Code: 60

Note that each file that is uploaded must have the same GUID but a different File Type/Index

These services generally use [Encryption Type 6](https://github.com/worthingtonse/client-prompts/blob/main/CONTEXT/request-header-format-for-256-bit-encryption.md#encryption-type-6) . However, if the QMail server is located on a RAIDA, it is possible that any encryption type could be used. Because off this, a key exchange must occure between the client and QMNail server before commands like this can be issued. 

Sample Request:
```
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH // Challenge
SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE // Session key
Send Qmail CBD File
PD PD PD ... ? // Padding to make all body bytes (except for the E3 E3 ) divisable by 32.
E3 E3 //Not encrypted
```

### Send Email CBDF
Fixed Request Header
Key Code | Bytes | Name & Description | Required
---|---|---|---
0 |  1 | Number of Key Value Pairs | Required
1 | 16 | Email Guid. A unique number randomly generated by the client and used for all raida mail servers for the same email. This number is put on the email file and all subsequent attachment files | Required
2 | 1 | File Type. See [Qmail File Types](https://github.com/worthingtonse/client-prompts/blob/main/Ideas%20In%20Progress/QMAIL/qmail-file-types.md#qmail-file-types) | Required
3 | 2 | RAID Type. See [Raid Codes](raid-codes.md) | Required
4 |  Varries. Divisable by 7 | To Array. Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. | Requires at least one
5 |  Varries. Divisable by 7 | CC Array. Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. | Not required
6 |  Varries. Divisable by 7 | BCC Array. Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. | Not required
7 |  Varries according to file stripe size  | Binary Data | Required

Response Status Codes
```C
STATUS_SUCCESS = 250
ERROR_FEW_COINS_IN_LOCKER = 153,
ERROR_LOCKER_EMPTY_OR_NOT_EXISTS = 179,
ERROR_INVALID_PARAMETER = 198,
```


## PING
Command Group: 6

Command Code: 61

The PING service allows the client to create a session with the QMail server so that the QMail server can instantly  inform the user should the QMail server receive an email from the user. This service must always use TCP and not UDP to allow the timeout to last more than 2 minutes. The ping is a keep alive and must be reissued from time to time. 

The qmail sender will send their messages to many QMail servers at the same time. It is not necessary for all the QMail servers to push warning to the client. The client controls which QMail server should be the one that informs it of new messages. To reduce the amount of RAM needed by QMail servers to track sessions, the client should make a list of the four QMail servers that are closest to it (in milliseconds) and then choose from these QMail servers randomly to distribute the load. 

Sample Request:
```
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH // Challenge
SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE // Session key
Send Qmail CBD File
PD PD PD ... ? // Padding to make all body bytes (except for the E3 E3 ) divisable by 32.
E3 E3 //Not encrypted
```

The client will then wait for the QMail server to send it a message:

Response Status Codes
```C
STATUS_YOU_GOT_MAIL = 11
STATUS_SESSION_TIMEOUT = 12
```
With this response, the client should call the PEEK Mail service. 

## PEEK Mail
Command Group: 6

Command Code: 62

The user must first log in to get a session key. 

After getting a session key, the user can download all the meta data up to a certain amount of data. See the [Meta Data CBD File Format](meta-file-format.md )

Sample Request:
```
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH // Challenge
SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE SE // Session key
PD PD PD ... ? // Padding to make all body bytes (except for the E3 E3 ) divisable by 32.
E3 E3 //Not encrypted
```




