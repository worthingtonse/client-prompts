# Send Qmail
Allows people to send and receive qmail including attachments. 

## File Transfer
Send Qmail is a file transfer protocol that transfer files from the user's computer to the mail folder owned by the receiver that is located on the Qmail server. 
The qmail files are named like "e85105d6-7972-4493-8e98-63261d6cf643.stripe005.type001.gmail" with the qmail id, stipe number and type.
If the file is stored on the client computer, it's stipe ID will be replaced with the word "whole".
Each file is sent seperatly. Therefor, there will need to be an extra call to the QMail server for every attachment that is included. 
Each call to the send-qmail service that includes many files must use the same qmail ID (GUID), but with a unque file type. 

## Editing Sent Qmails
If the user would like to update the qmail after it is was sent, they can upload a file with the same GUID and file type with the
"Overwrite" command set. 
If the overwrite is successful, and the email has not already been received by the sender, then the QMail server will respond with success (0xFA). However, if the file to be overwritten is no longer on the server, because it has been downloaded, the overwrite request status
will be an error. 

## File Descriptor
The number of file attachments allowed is determined by the QMail server and found in the DRD.
Descriptor ID | Name | Description
---|---|---
0 | qmail | The actual qmail file
1 | qtext | Reserved for future use
2 | qmessage | Reserved for future use
3 | User's  Secret CBDF | A CBDF file containing avatars, codenamesm descriptions, styles that are not available to the public. 
4 | Group's Secret CBDF |  A CBDF file containing avatars, codenames, descriptions, styles that are not available to the public. These help people identify spoofing a user.  
5 | qmessage | Reserved for future use
10 | Attachment 0 | The first attachment
11 | Attachment 1 | The second attachment
255 | Attachment 255 | The 255th attachment // IDs 12 to 254 left out for brevity

## File Size
The size of the total file sent that is allowed is determined by the QMail server and found in the DRD.

## Request Body
```
CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH CH // Challenge
Send Mail CBDF
E3 E3 // end of body
```

## Send Mail CBDF Format
The request is formatted as a CBDF with a fixed part and a variable part. 

### Fixed Part
Name | Bytes | Description
---|---|---
Email's GUID | 16 | A unique number randomly generated by the client and used for all raida mail servers for the same email. This number is put on the email file and all subsequent attachment files
File Type/index | 1 | 0 if it is an email file. 1 = first attachment and up as more files are added. 
Primary Sender ID | 6 | 2 byte for coin ID, 1 Denomination, 4 Serial Number. Coin ID will be 0x0006 for Phase I. 
Primary Receiver ID | 6 | 2 byte for coin ID, 1 Denomination, 4 Serial Number. Coin ID will be 0x0006 for Phase I. 
RAID Type | 1 | 0 = Stripe, 1 = Mirror, 5 = Stripe with Parity, 6 = Stripe with Vertical Parity, Stripe with Horizontal Parity, 7 = Striped with Horizontal and Vertical Parity, 8 = Striped with Horizontal, Vertical and Diagnal Parity, 10 = Mirroed stripes
Stripe Number | 1 | A number 0 to N (up to 32 servers)
Of Number |1 | Such as "7" of "25" Where 25 is the Of Number


Send Mail Resource Table
ID | Field Name | Example | Description
---|---|---|---
1 | To Array | 00 06 12 45 43 A4 00 06 12 D3 35 02 | Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. 
2 | CCs Array | 00 06 12 09 73 A4 00 06 12 09 73 A4  | Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. 
3 | BCCs Array | 00 06 12 09 73 A4  | Seven bytes each. Coin type 0x0006, Denomination, 4 byte serial number. 
4 | Ticket Array* | R1 00 01 02 03 R2 00 01 02 03 04 | Tickets that the user obtained by the client to prove their identity.  
5 | Subject Stripe | 05 DE 23 | Raid type, Stripe Number, 'Of Number' all remaining bytes (253) can be used for the subject. 

<!--
6 | Shuffle Table Shard 1 | A square of the Of Number. If there are 16 servers, the shuffle table will be 16 x 16 or 256 bytes. This is the first 8 rows.  The numbers in each cell will be represented by five bits. See table below. | PHASE II
7 | Shuffle Table Shard 2 | Like above. This is the Second 8 rows. | PHASE II
8 | Shuffle Table Shard 3 | Like above. This is the Second 8 rows. | PHASE II
-->

Return Status Codes
```C
ERROR_OVERWRITE_FAILED_FILE_WAS_REMOVED_OR_NEVER_EXISTED = 8,
STATUS_SUCCESS = 250
ERROR_FEW_COINS_IN_LOCKER = 153,
ERROR_LOCKER_EMPTY_OR_NOT_EXISTS = 179,
ERROR_INVALID_PARAMETER = 198,
```
